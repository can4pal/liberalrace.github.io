<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Multi-Step Form</title>

  <!-- Minimal Required CSS (Bootstrap) -->
  <link 
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"
  />

  <style>
    /* Basic styling for layout and form appearance */
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.4)),
        /* Change the URL if you don't want this placeholder background */
        url('https://via.placeholder.com/1920x1080') no-repeat center center fixed;
      background-size: cover;
      font-family: Lato, sans-serif;
    }

    #Wrapper {
      background-color: #fff;
      max-width: 550px;
      margin: 40px auto;
      padding: 20px 30px;
      box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
    }

    h1 {
      text-transform: uppercase;
      font-family: Oswald, sans-serif;
      color: #d71920;
      text-align: center;
      margin: 0 0 0.5em;
    }
    .subheading {
      font-size: 1.1rem;
      font-weight: 900;
      color: #58595c;
      text-align: center;
      margin-bottom: 20px;
    }

    label {
      font-weight: bold;
      margin-top: 10px;
      color: #4d4d4d;
    }
    .required {
      color: #d71920;
    }

    /* Inputs, selects */
    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="number"],
    input[type="date"],
    select {
      width: 100%;
      padding: 6px 10px;
      margin: 5px 0;
      box-sizing: border-box;
      border-radius: 4px;
      border: 1px solid #ccc;
      font-family: Lato, sans-serif;
      font-weight: 300;
    }

    /* Validation error messages */
    .VAL_ERR {
      display: none;
      color: #d71920;
      font-size: 0.9rem;
      margin-top: 2px;
    }

    /* Buttons */
    .button {
      display: inline-block;
      background-color: #d71920;
      color: #fff;
      border: none;
      border-radius: 4px;
      padding: 0.5em 1em;
      cursor: pointer;
      font-family: Lato, sans-serif;
      margin: 10px 5px 0 0;
    }
    .button:hover {
      background-color: #b11116;
    }
    .next {
      float: right;
    }
    .previous {
      float: left;
    }

    /* Step container: We'll show/hide these for multi-step form */
    .step-container {
      display: none; /* Hidden by default; we reveal step 1 initially */
    }

    /* Spinner overlay */
    #spinner-overlay {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.75);
    }
    #spinner {
      position: absolute;
      top: 50%;
      left: 50%;
      font-size: 50px;
      color: #eee;
      transform: translate(-50%, -50%);
    }

    /* Clear floats */
    .clearfix::after {
      content: "";
      clear: both;
      display: table;
    }
  </style>
</head>
<body>
  <!-- SPINNER OVERLAY -->
  <div id="spinner-overlay">
    <!-- Using a Bootstrap Glyphicon for spinner -->
    <div id="spinner" class="glyphicon glyphicon-repeat glyphicon-spin"></div>
  </div>

  <div id="Wrapper">
    <header>
      <h1>Be a part of the most open movement</h1>
      <div class="subheading">
        Register today and join the team thatâ€™s focused on Canadians
      </div>
    </header>

    <!-- STEP 1 -->
    <div id="step1" class="step-container">
      <form id="form-part1">
        <div class="row">
          <div class="col-sm-6">
            <label for="cr802_FirstName">
              First Name <span class="required">*</span>
            </label>
            <input
              type="text"
              id="cr802_FirstName"
              name="cr802_FirstName"
              placeholder="First Name"
            />
            <div class="VAL_ERR" id="err_firstname">This Field is required</div>
          </div>
          <div class="col-sm-6">
            <label for="cr802_LastName">
              Last Name <span class="required">*</span>
            </label>
            <input
              type="text"
              id="cr802_LastName"
              name="cr802_LastName"
              placeholder="Last Name"
            />
            <div class="VAL_ERR" id="err_lastname">This Field is required</div>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-6">
            <label for="cr802_EmailAddress">
              Email <span class="required">*</span>
            </label>
            <input
              type="text"
              id="cr802_EmailAddress"
              name="cr802_EmailAddress"
              placeholder="Email"
            />
            <div class="VAL_ERR" id="err_email">Invalid Email</div>
          </div>
          <div class="col-sm-6">
            <label for="cr802_MobileNumber">
              Mobile Phone <span class="required">*</span>
            </label>
            <input
              type="text"
              id="cr802_MobileNumber"
              name="cr802_MobileNumber"
              placeholder="(999)-999-9999"
            />
            <div class="VAL_ERR" id="err_phone">Invalid Phone Number</div>
          </div>
        </div>

        <label style="font-weight: normal;">
          By providing your mobile phone number, you consent to receive recurring text messages. 
          Message frequency may vary. Message & Data Rates May Apply. 
          Text HELP for Info. Text STOP to opt out.
          <a href="#" target="_blank">Terms & Conditions</a>.
        </label>

        <div class="clearfix"></div>
        <button type="button" class="button next" id="nextToStep2">
          Next
        </button>
      </form>
    </div>

    <!-- STEP 2 -->
    <div id="step2" class="step-container">
      <form id="form-part2">
        <div class="row">
          <div class="col-sm-6">
            <label for="cr802_HomeAddress">
              Home Address <span class="required">*</span>
            </label>
            <input
              type="text"
              id="cr802_HomeAddress"
              name="cr802_HomeAddress"
              placeholder="Home Address"
            />
            <div class="VAL_ERR" id="err_address">This Field is required</div>
          </div>
          <div class="col-sm-6">
            <label for="cr802_City">
              City <span class="required">*</span>
            </label>
            <input
              type="text"
              id="cr802_City"
              name="cr802_City"
              placeholder="City"
            />
            <div class="VAL_ERR" id="err_city">This Field is required</div>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-6">
            <label for="cr802_Province">
              Province <span class="required">*</span>
            </label>
            <select id="cr802_Province" name="cr802_Province">
              <option value="">-- Select --</option>
              <option value="AB">Alberta</option>
              <option value="BC">British Columbia</option>
              <option value="MB">Manitoba</option>
              <option value="NB">New Brunswick</option>
              <option value="NL">Newfoundland & Labrador</option>
              <option value="NS">Nova Scotia</option>
              <option value="NT">Northwest Territories</option>
              <option value="NU">Nunavut</option>
              <option value="ON">Ontario</option>
              <option value="PE">Prince Edward Island</option>
              <option value="QC">Quebec</option>
              <option value="SK">Saskatchewan</option>
              <option value="YT">Yukon</option>
            </select>
            <div class="VAL_ERR" id="err_province">Select an option</div>
          </div>
          <div class="col-sm-6">
            <label for="cr802_PostalCode">
              Postal Code <span class="required">*</span>
            </label>
            <input
              type="text"
              id="cr802_PostalCode"
              name="cr802_PostalCode"
              placeholder="A1A 1A1"
            />
            <div class="VAL_ERR" id="err_postalcode">Invalid Postal Code</div>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-6">
            <label for="cr802_DateofBirth">
              Date of Birth <span class="required">*</span>
            </label>
            <input
              type="text"
              id="cr802_DateofBirth"
              name="cr802_DateofBirth"
              placeholder="DD/MM/YYYY"
            />
            <div class="VAL_ERR" id="err_dob">Invalid Date of Birth</div>
          </div>
          <div class="col-sm-6" style="margin-top: 30px;">
            <!-- OPTIONAL Indigenous identity -->
            <input
              type="checkbox"
              id="cr802_IndigenousAncestry"
              name="cr802_IndigenousAncestry"
              style="margin-right:5px;"
            />
            <label for="cr802_IndigenousAncestry" style="font-weight: normal;">
              I am of Indigenous Ancestry
            </label>
          </div>
        </div>

        <hr />

        <div class="row">
          <div class="col-sm-12">
            <input
              type="checkbox"
              id="cr802_TermsCondition"
              name="cr802_TermsCondition"
              style="margin-right:5px;"
            />
            <label for="cr802_TermsCondition" style="font-weight: normal;">
              I support the purposes of this organization, 
              and I agree to abide by the stated <a href="#" target="_blank">Constitution</a>.
            </label>
            <div class="VAL_ERR" id="err_agree">You must agree to proceed</div>
          </div>
        </div>

        <div class="clearfix"></div>
        <button type="button" class="button previous" id="backToStep1">
          Back
        </button>
        <button type="button" class="button next" id="submitForm">
          Submit
        </button>
      </form>
    </div>
  </div>

  <!-- Minimal Required JS: jQuery + Inputmask from CDN. Bootstrap JS is optional. -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.4/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/inputmask@5.0.8/dist/jquery.inputmask.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>

  <script>
    // Your Power Automate (Flow) endpoint:
    const powerAutomateUrl = "https://prod-21.canadacentral.logic.azure.com:443/workflows/7b96cc8b950c4de38b1b4844990edaf1/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=7yET91vqzWVT9Vqisgg5WKWipoFd9j0waOPfEG62OM8";

    // On page load, show step1
    $(document).ready(function () {
      $("#step1").show(); // initial step

      // Input Masks
      $("#cr802_MobileNumber").inputmask("(999)-999-9999", {
        showMaskOnHover: false,
      });
      $("#cr802_DateofBirth").inputmask("99/99/9999", {
        placeholder: "DD/MM/YYYY",
        showMaskOnHover: false,
      });
      $("#cr802_PostalCode").inputmask("A9A 9A9", {
        showMaskOnHover: false,
        definitions: {
          A: {
            validator: "[A-Za-z]",
          },
        },
      });

      // Next -> Step 2
      $("#nextToStep2").on("click", function () {
        if (validateStep1()) {
          $("#step1").hide();
          $("#step2").show();
        }
      });

      // Back -> Step 1
      $("#backToStep1").on("click", function () {
        $("#step2").hide();
        $("#step1").show();
      });

      // Submit the entire form
      $("#submitForm").on("click", function () {
        if (validateStep2()) {
          showSpinner();

          // Construct payload from the validated fields
          const payload = {
            cr802_FirstName: $("#cr802_FirstName").val().trim(),
            cr802_LastName: $("#cr802_LastName").val().trim(),
            cr802_EmailAddress: $("#cr802_EmailAddress").val().trim(),
            cr802_MobileNumber: $("#cr802_MobileNumber").val().trim(),
            cr802_HomeAddress: $("#cr802_HomeAddress").val().trim(),
            cr802_City: $("#cr802_City").val().trim(),
            cr802_Province: $("#cr802_Province").val(),
            cr802_PostalCode: $("#cr802_PostalCode").val().trim(),
            cr802_DateofBirth: $("#cr802_DateofBirth").val().trim(),
            cr802_IndigenousAncestry: $("#cr802_IndigenousAncestry").is(":checked"),
            cr802_TermsCondition: $("#cr802_TermsCondition").is(":checked"),
          };

          // POST to your Power Automate flow
          fetch(powerAutomateUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          })
            .then((res) => {
              if (!res.ok) throw new Error("Network response was not OK");
              return res.text(); // or res.json(), depending on your Flow response
            })
            .then((data) => {
              hideSpinner();
              alert("Thank you for registering!");
            })
            .catch((err) => {
              hideSpinner();
              console.error(err);
              alert("Oops, something went wrong!");
            });
        }
      });
    });

    function validateStep1() {
      let valid = true;

      hideError("cr802_FirstName", "err_firstname");
      hideError("cr802_LastName", "err_lastname");
      hideError("cr802_EmailAddress", "err_email");
      hideError("cr802_MobileNumber", "err_phone");

      // First Name
      if (!$("#cr802_FirstName").val().trim()) {
        showError("cr802_FirstName", "err_firstname", "This Field is required");
        valid = false;
      }
      // Last Name
      if (!$("#cr802_LastName").val().trim()) {
        showError("cr802_LastName", "err_lastname", "This Field is required");
        valid = false;
      }
      // Email
      const emailVal = $("#cr802_EmailAddress").val().trim();
      if (!emailVal || !/^\S+@\S+\.\S+$/.test(emailVal)) {
        showError("cr802_EmailAddress", "err_email", "Invalid Email");
        valid = false;
      }
      // Phone (check for minimal 10 digits)
      const phoneVal = $("#cr802_MobileNumber").val().trim();
      const digits = phoneVal.replace(/\D/g, "");
      if (digits.length < 10) {
        showError("cr802_MobileNumber", "err_phone", "Invalid Phone Number");
        valid = false;
      }

      return valid;
    }

    function validateStep2() {
      let valid = true;

      hideError("cr802_HomeAddress", "err_address");
      hideError("cr802_City", "err_city");
      hideError("cr802_Province", "err_province");
      hideError("cr802_PostalCode", "err_postalcode");
      hideError("cr802_DateofBirth", "err_dob");
      hideError("cr802_TermsCondition", "err_agree");

      if (!$("#cr802_HomeAddress").val().trim()) {
        showError("cr802_HomeAddress", "err_address", "This Field is required");
        valid = false;
      }
      if (!$("#cr802_City").val().trim()) {
        showError("cr802_City", "err_city", "This Field is required");
        valid = false;
      }
      if (!$("#cr802_Province").val()) {
        showError("cr802_Province", "err_province", "Select an option");
        valid = false;
      }
      // Postal code check: ensure it's not empty; Inputmask enforces the pattern
      const postalVal = $("#cr802_PostalCode").val().trim();
      if (!postalVal) {
        showError("cr802_PostalCode", "err_postalcode", "Invalid Postal Code");
        valid = false;
      }
      // Minimal check for DOB
      const dobVal = $("#cr802_DateofBirth").val().trim();
      if (!dobVal || dobVal.length < 10) {
        showError("cr802_DateofBirth", "err_dob", "Invalid Date of Birth");
        valid = false;
      }
      // Must agree to Terms
      if (!$("#cr802_TermsCondition").is(":checked")) {
        showError("cr802_TermsCondition", "err_agree", "You must agree to proceed");
        valid = false;
      }

      return valid;
    }

    function showError(inputId, errorId, message) {
      $("#" + inputId).css("border", "2px solid #c10f17");
      $("#" + errorId).text(message).show();
    }
    function hideError(inputId, errorId) {
      $("#" + inputId).css("border", "1px solid #ccc");
      $("#" + errorId).hide();
    }

    function showSpinner() {
      $("#spinner-overlay").show();
    }
    function hideSpinner() {
      $("#spinner-overlay").hide();
    }
  </script>
</body>
</html>
